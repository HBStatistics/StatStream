<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search YouTube Channel - StatStream</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        .brand-logo {
            position: absolute;
            top: 1rem;
            left: 1.5rem;
            font-size: 1.25rem;
            font-weight: 500;
        }

        .brand-logo a {
            text-decoration: none;
        }

        main {
            width: 100%;
            max-width: 600px;
            text-align: center;
            margin-top: 4rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }

        #comparison-tray {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            width: 100%;
        }

        .comparison-slot {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border-radius: 12px;
            border: 2px dashed;
            min-height: 44px;
            cursor: pointer;
            overflow: hidden;
        }

        .comparison-slot img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .comparison-slot .channel-name {
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        #compare-btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 2rem;
            transition: background-color 0.3s, opacity 0.3s, color 0.3s;
        }

        .search-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        #search-input {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border-radius: 20px;
            font-size: 1rem;
        }

        #search-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background-color: #cc0000;
            color: white;
            font-weight: 500;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #search-btn:hover {
            background-color: #ff0000;
        }

        #results-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            text-align: left;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            padding: 1rem;
            border-radius: 12px;
        }

        .result-item-link {
            text-decoration: none; /* Remove underline from links */
            color: inherit; /* Inherit text color */
        }

        .result-item img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }

        .result-item .channel-name {
            font-size: 1.1rem;
            font-weight: 500;
        }

        #theme-toggle-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            background: none;
            border: 1px solid;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s, border-color 0.3s;
        }

        /* Light Theme */
        .light-theme { background-color: #f9f9f9; color: #0f0f0f; }
        .light-theme .brand-logo a { color: #606060; }
        .light-theme #search-input { background-color: #fff; border: 1px solid #ccc; color: #0f0f0f; }
        .light-theme .comparison-slot { border-color: #ccc; }
        .light-theme #compare-btn { background-color: #cc0000; color: white; }
        .light-theme #compare-btn.disabled { background-color: #ccc; color: #666; opacity: 0.7; pointer-events: none; }
        .light-theme .result-item { background-color: #fff; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .light-theme #theme-toggle-btn { color: #0f0f0f; border-color: #ccc; }

        /* Dark Theme */
        .dark-theme { background-color: #1a1a1a; color: #e0e0e0; }
        .dark-theme .brand-logo a { color: #b0b0b0; }
        .dark-theme #search-input { background-color: #2a2a2a; border: 1px solid #333; color: #e0e0e0; }
        .dark-theme .comparison-slot { border-color: #333; }
        .dark-theme #compare-btn { background-color: #cc0000; color: white; }
        .dark-theme #compare-btn.disabled { background-color: #555; color: #999; opacity: 0.7; pointer-events: none; }
        .dark-theme .result-item { background-color: #2a2a2a; border: 1px solid #333; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .dark-theme #theme-toggle-btn { color: #e0e0e0; border-color: #333; }
    </style>
</head>
<body>
    <div class="brand-logo">
        <a href="index.html">StatStream</a>
    </div>
    <button id="theme-toggle-btn" title="Toggle Theme"></button>

    <main>
        <h1>Search for a YouTube Channel</h1>

        <div id="comparison-tray">
            <div class="comparison-slot" id="slot-1" title="Click to remove">
                <span>Select Channel 1</span>
            </div>
            <div class="comparison-slot" id="slot-2" title="Click to remove">
                <span>Select Channel 2</span>
            </div>
        </div>
        <a href="#" id="compare-btn" class="disabled">Compare Channels</a>

        <div class="search-container">
            <input type="text" id="search-input" placeholder="Enter channel name, e.g., 'MrBeast'">
            <button id="search-btn">Search</button>
        </div>
        <div id="results-container">
            <!-- Search results will be displayed here -->
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchBtn = document.getElementById('search-btn');
            const searchInput = document.getElementById('search-input');
            const resultsContainer = document.getElementById('results-container');
            const compareBtn = document.getElementById('compare-btn');
            const slot1 = document.getElementById('slot-1');
            const slot2 = document.getElementById('slot-2');

            let selectedChannels = [];

            // --- IMPORTANT ---
            // You must get your own API key from the Google Cloud Console.
            // 1. Go to https://console.cloud.google.com/
            // 2. Create a new project.
            // 3. Enable the "YouTube Data API v3".
            // 4. Create credentials -> API key.
            // 5. Replace 'YOUR_API_KEY_HERE' with your key.
            const API_KEY = 'AIzaSyBgELAGkvluwfu6CNKHNDTwq20_8lckcZU';

            const updateComparisonUI = () => {
                const slots = [slot1, slot2];
                slots.forEach((slot, index) => {
                    if (selectedChannels[index]) {
                        slot.innerHTML = `
                            <img src="${selectedChannels[index].thumbnail}" alt="${selectedChannels[index].title}">
                            <span class="channel-name">${selectedChannels[index].title}</span>`;
                    } else {
                        slot.innerHTML = `<span>Select Channel ${index + 1}</span>`;
                    }
                });

                if (selectedChannels.length === 2) {
                    compareBtn.classList.remove('disabled');
                    compareBtn.href = `compare.html?id1=${selectedChannels[0].id}&id2=${selectedChannels[1].id}`;
                } else {
                    compareBtn.classList.add('disabled');
                    compareBtn.href = '#';
                }
            };

            const selectChannel = (channelInfo) => {
                if (selectedChannels.find(c => c.id === channelInfo.id)) return; // Avoid duplicates
                if (selectedChannels.length < 2) {
                    selectedChannels.push(channelInfo);
                    updateComparisonUI();
                }
            };

            slot1.addEventListener('click', () => {
                if (selectedChannels[0]) {
                    selectedChannels.splice(0, 1);
                    updateComparisonUI();
                }
            });
            slot2.addEventListener('click', () => {
                if (selectedChannels[1]) {
                    selectedChannels.splice(1, 1); // This is tricky if slot 1 was cleared first.
                    selectedChannels = selectedChannels.filter((c, i) => i !== 1); // Safer removal
                    updateComparisonUI();
                }
            });

            const searchChannels = async () => {
                const query = searchInput.value.trim();
                if (!query) {
                    alert('Please enter a channel name to search.');
                    return;
                }
                if (API_KEY === 'YOUR_API_KEY_HERE') {
                    resultsContainer.innerHTML = `<p style="color: red; font-weight: bold;">API Key not set. Please edit search.html to add your YouTube Data API key.</p>`;
                    return;
                }

                resultsContainer.innerHTML = '<p>Searching...</p>';
                const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=channel&maxResults=10&key=${API_KEY}`;

                try {
                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.error) {
                        throw new Error(data.error.message);
                    }
                    
                    displayResults(data.items);
                } catch (error) {
                    console.error('Error fetching data from YouTube API:', error);
                    resultsContainer.innerHTML = `<p style="color: red;">Error: ${error.message}. Check the console for more details.</p>`;
                }
            };

            const displayResults = (items) => {
                resultsContainer.innerHTML = ''; // Clear previous results or "Searching..." message
                if (!items || items.length === 0) {
                    resultsContainer.innerHTML = '<p>No channels found for that name.</p>';
                    return;
                }

                items.forEach(item => {
                    const { title, thumbnails } = item.snippet; // item.snippet.channelId is not directly available here, but item.id.channelId is
                    const channelId = item.id.channelId; // Get the channel ID
                    const resultItem = document.createElement('div');
                    resultItem.classList.add('result-item');
                    resultItem.innerHTML = `
                        <img src="${thumbnails.default.url}" alt="Logo for ${title}">
                        <span class="channel-name">${title}</span>`;
                    
                    resultItem.addEventListener('click', () => selectChannel({
                        id: channelId,
                        title: title,
                        thumbnail: thumbnails.default.url
                    }));
                    resultsContainer.appendChild(resultItem);
                });
            };

            searchBtn.addEventListener('click', searchChannels);
            searchInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    searchChannels();
                }
            });
        });
    </script>
    <script src="theme.js" defer></script>
</body>
</html>
